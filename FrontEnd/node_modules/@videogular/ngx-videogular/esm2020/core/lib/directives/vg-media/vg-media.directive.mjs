import { Directive, Input, ChangeDetectorRef, } from '@angular/core';
import { Observable, Subject, fromEvent, timer, combineLatest, } from 'rxjs';
import { map } from 'rxjs/operators';
import { VgApiService } from '../../services/vg-api/vg-api.service';
import { VgStates } from '../../services/states/vg-states.service';
import { VgEvents } from '../../services/events/vg-events.service';
import * as i0 from "@angular/core";
import * as i1 from "../../services/vg-api/vg-api.service";
export class VgMediaDirective {
    constructor(api, ref) {
        this.api = api;
        this.ref = ref;
        this.state = VgStates.VG_PAUSED;
        this.time = { current: 0, total: 0, left: 0 };
        this.buffer = { end: 0 };
        this.canPlay = false;
        this.canPlayThrough = false;
        this.isMetadataLoaded = false;
        this.isWaiting = false;
        this.isCompleted = false;
        this.isLive = false;
        this.isBufferDetected = false;
        this.checkInterval = 200;
        this.currentPlayPos = 0;
        this.lastPlayPos = 0;
        this.playAtferSync = false;
        this.bufferDetected = new Subject();
    }
    ngOnInit() {
        if (this.vgMedia.nodeName) {
            // It's a native element
            this.elem = this.vgMedia;
        }
        else {
            // It's an Angular Class
            this.elem = this.vgMedia.elem;
        }
        // Just in case we're creating this vgMedia dynamically register again into API
        this.api.registerMedia(this);
        this.subscriptions = {
            // Native events
            abort: fromEvent(this.elem, VgEvents.VG_ABORT),
            canPlay: fromEvent(this.elem, VgEvents.VG_CAN_PLAY),
            canPlayThrough: fromEvent(this.elem, VgEvents.VG_CAN_PLAY_THROUGH),
            durationChange: fromEvent(this.elem, VgEvents.VG_DURATION_CHANGE),
            emptied: fromEvent(this.elem, VgEvents.VG_EMPTIED),
            encrypted: fromEvent(this.elem, VgEvents.VG_ENCRYPTED),
            ended: fromEvent(this.elem, VgEvents.VG_ENDED),
            error: fromEvent(this.elem, VgEvents.VG_ERROR),
            loadedData: fromEvent(this.elem, VgEvents.VG_LOADED_DATA),
            loadedMetadata: fromEvent(this.elem, VgEvents.VG_LOADED_METADATA),
            loadStart: fromEvent(this.elem, VgEvents.VG_LOAD_START),
            pause: fromEvent(this.elem, VgEvents.VG_PAUSE),
            play: fromEvent(this.elem, VgEvents.VG_PLAY),
            playing: fromEvent(this.elem, VgEvents.VG_PLAYING),
            progress: fromEvent(this.elem, VgEvents.VG_PROGRESS),
            rateChange: fromEvent(this.elem, VgEvents.VG_RATE_CHANGE),
            seeked: fromEvent(this.elem, VgEvents.VG_SEEKED),
            seeking: fromEvent(this.elem, VgEvents.VG_SEEKING),
            stalled: fromEvent(this.elem, VgEvents.VG_STALLED),
            suspend: fromEvent(this.elem, VgEvents.VG_SUSPEND),
            timeUpdate: fromEvent(this.elem, VgEvents.VG_TIME_UPDATE),
            volumeChange: fromEvent(this.elem, VgEvents.VG_VOLUME_CHANGE),
            waiting: fromEvent(this.elem, VgEvents.VG_WAITING),
            // Advertisement only events
            startAds: fromEvent(window, VgEvents.VG_START_ADS),
            endAds: fromEvent(window, VgEvents.VG_END_ADS),
            // See changes on <source> child elements to reload the video file
            mutation: new Observable((observer) => {
                const domObs = new MutationObserver((mutations) => {
                    observer.next(mutations);
                });
                domObs.observe(this.elem, { childList: true, attributes: true });
                return () => {
                    domObs.disconnect();
                };
            }),
            // Custom buffering detection
            bufferDetected: this.bufferDetected,
        };
        this.mutationObs = this.subscriptions.mutation.subscribe(this.onMutation.bind(this));
        this.canPlayObs = this.subscriptions.canPlay.subscribe(this.onCanPlay.bind(this));
        this.canPlayThroughObs = this.subscriptions.canPlayThrough.subscribe(this.onCanPlayThrough.bind(this));
        this.loadedMetadataObs = this.subscriptions.loadedMetadata.subscribe(this.onLoadMetadata.bind(this));
        this.waitingObs = this.subscriptions.waiting.subscribe(this.onWait.bind(this));
        this.progressObs = this.subscriptions.progress.subscribe(this.onProgress.bind(this));
        this.endedObs = this.subscriptions.ended.subscribe(this.onComplete.bind(this));
        this.playingObs = this.subscriptions.playing.subscribe(this.onStartPlaying.bind(this));
        this.playObs = this.subscriptions.play.subscribe(this.onPlay.bind(this));
        this.pauseObs = this.subscriptions.pause.subscribe(this.onPause.bind(this));
        this.timeUpdateObs = this.subscriptions.timeUpdate.subscribe(this.onTimeUpdate.bind(this));
        this.volumeChangeObs = this.subscriptions.volumeChange.subscribe(this.onVolumeChange.bind(this));
        this.errorObs = this.subscriptions.error.subscribe(this.onError.bind(this));
        if (this.vgMaster) {
            this.api.playerReadyEvent.subscribe(() => {
                this.prepareSync();
            });
        }
    }
    prepareSync() {
        const canPlayAll = [];
        for (const media in this.api.medias) {
            if (this.api.medias[media]) {
                canPlayAll.push(this.api.medias[media].subscriptions.canPlay);
            }
        }
        this.canPlayAllSubscription = combineLatest(canPlayAll)
            .pipe(map((...params) => {
            const checkReadyState = (event) => {
                if (!event?.target) {
                    return false;
                }
                return event.target.readyState === 4;
            };
            const allReady = params.some(checkReadyState);
            if (allReady && !this.syncSubscription) {
                this.startSync();
                this.syncSubscription.unsubscribe();
            }
        }))
            .subscribe();
    }
    startSync() {
        this.syncSubscription = timer(0, 1000).subscribe(() => {
            for (const media in this.api.medias) {
                if (this.api.medias[media] !== this) {
                    const diff = this.api.medias[media].currentTime - this.currentTime;
                    if (diff < -0.3 || diff > 0.3) {
                        this.playAtferSync = this.state === VgStates.VG_PLAYING;
                        this.pause();
                        this.api.medias[media].pause();
                        this.api.medias[media].currentTime = this.currentTime;
                    }
                    else {
                        if (this.playAtferSync) {
                            this.play();
                            this.api.medias[media].play();
                            this.playAtferSync = false;
                        }
                    }
                }
            }
        });
    }
    onMutation(mutations) {
        // Detect changes only for source elements or src attribute
        for (let i = 0, l = mutations.length; i < l; i++) {
            const mut = mutations[i];
            if (mut.type === 'attributes' && mut.attributeName === 'src') {
                // Only load src file if it's not a blob (for DASH / HLS sources)
                if (mut.target.src &&
                    mut.target.src.length > 0 &&
                    mut.target.src.indexOf('blob:') < 0) {
                    this.loadMedia();
                    break;
                }
            }
            else if (mut.type === 'childList' &&
                mut.removedNodes.length &&
                mut.removedNodes[0].nodeName.toLowerCase() === 'source') {
                this.loadMedia();
                break;
            }
        }
    }
    loadMedia() {
        this.vgMedia.pause();
        this.vgMedia.currentTime = 0;
        // Start buffering until we can play the media file
        this.stopBufferCheck();
        this.isBufferDetected = true;
        this.bufferDetected.next(this.isBufferDetected);
        // TODO: This is ugly, we should find something cleaner. For some reason a TimerObservable doesn't works.
        setTimeout(() => this.vgMedia.load(), 10);
    }
    play() {
        // short-circuit if already playing
        if (this.playPromise ||
            (this.state !== VgStates.VG_PAUSED && this.state !== VgStates.VG_ENDED)) {
            return;
        }
        this.playPromise = this.vgMedia.play();
        // browser has async play promise
        if (this.playPromise && this.playPromise.then && this.playPromise.catch) {
            this.playPromise
                .then(() => {
                this.playPromise = null;
            })
                .catch(() => {
                this.playPromise = null;
                // deliberately empty for the sake of eating console noise
            });
        }
        return this.playPromise;
    }
    pause() {
        // browser has async play promise
        if (this.playPromise) {
            this.playPromise.then(() => {
                this.vgMedia.pause();
            });
        }
        else {
            this.vgMedia.pause();
        }
    }
    get id() {
        // We should return undefined if vgMedia still doesn't exist
        let result;
        if (this.vgMedia) {
            result = this.vgMedia.id;
        }
        return result;
    }
    get duration() {
        return this.vgMedia.duration === Infinity
            ? this.specifiedDuration
            : this.vgMedia.duration;
    }
    set currentTime(seconds) {
        this.vgMedia.currentTime = seconds;
        // this.elem.dispatchEvent(new CustomEvent(VgEvents.VG_SEEK));
    }
    get currentTime() {
        return this.vgMedia.currentTime;
    }
    set volume(volume) {
        this.vgMedia.volume = volume;
    }
    get volume() {
        return this.vgMedia.volume;
    }
    set playbackRate(rate) {
        this.vgMedia.playbackRate = rate;
    }
    get playbackRate() {
        return this.vgMedia.playbackRate;
    }
    get buffered() {
        return this.vgMedia.buffered;
    }
    get textTracks() {
        return this.vgMedia.textTracks;
    }
    // @ts-ignore
    onCanPlay(event) {
        this.isBufferDetected = false;
        this.bufferDetected.next(this.isBufferDetected);
        this.canPlay = true;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onCanPlayThrough(event) {
        this.isBufferDetected = false;
        this.bufferDetected.next(this.isBufferDetected);
        this.canPlayThrough = true;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onLoadMetadata(event) {
        this.isMetadataLoaded = true;
        this.time = {
            current: 0,
            left: 0,
            total: this.duration * 1000,
        };
        this.state = VgStates.VG_PAUSED;
        // Live streaming check
        const t = Math.round(this.time.total);
        this.isLive = t === Infinity;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onWait(event) {
        this.isWaiting = true;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onComplete(event) {
        this.isCompleted = true;
        this.state = VgStates.VG_ENDED;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onStartPlaying(event) {
        this.state = VgStates.VG_PLAYING;
        this.ref.detectChanges();
    }
    // @ts-ignore
    onPlay(event) {
        this.state = VgStates.VG_PLAYING;
        if (this.vgMaster) {
            if (!this.syncSubscription || this.syncSubscription.closed) {
                this.startSync();
            }
        }
        this.startBufferCheck();
        this.ref.detectChanges();
    }
    // @ts-ignore
    onPause(event) {
        this.state = VgStates.VG_PAUSED;
        if (this.vgMaster) {
            if (!this.playAtferSync) {
                this.syncSubscription.unsubscribe();
            }
        }
        this.stopBufferCheck();
        this.ref.detectChanges();
    }
    // @ts-ignore
    onTimeUpdate(event) {
        const end = this.buffered.length - 1;
        this.time = {
            current: this.currentTime * 1000,
            total: this.time.total,
            left: (this.duration - this.currentTime) * 1000,
        };
        if (end >= 0) {
            this.buffer = { end: this.buffered.end(end) * 1000 };
        }
        this.ref.detectChanges();
    }
    // @ts-ignore
    onProgress(event) {
        const end = this.buffered.length - 1;
        if (end >= 0) {
            this.buffer = { end: this.buffered.end(end) * 1000 };
        }
        this.ref.detectChanges();
    }
    // @ts-ignore
    onVolumeChange(event) {
        // TODO: Save to localstorage the current volume
        this.ref.detectChanges();
    }
    // @ts-ignore
    onError(event) {
        // TODO: Handle error messages
        this.ref.detectChanges();
    }
    // http://stackoverflow.com/a/23828241/779529
    bufferCheck() {
        const offset = 1 / this.checkInterval;
        this.currentPlayPos = this.currentTime;
        if (!this.isBufferDetected &&
            this.currentPlayPos < this.lastPlayPos + offset) {
            this.isBufferDetected = true;
        }
        if (this.isBufferDetected &&
            this.currentPlayPos > this.lastPlayPos + offset) {
            this.isBufferDetected = false;
        }
        // Prevent calls to bufferCheck after ngOnDestroy have been called
        if (!this.bufferDetected.closed) {
            this.bufferDetected.next(this.isBufferDetected);
        }
        this.lastPlayPos = this.currentPlayPos;
    }
    startBufferCheck() {
        this.checkBufferSubscription = timer(0, this.checkInterval).subscribe(() => {
            this.bufferCheck();
        });
    }
    stopBufferCheck() {
        if (this.checkBufferSubscription) {
            this.checkBufferSubscription.unsubscribe();
        }
        this.isBufferDetected = false;
        this.bufferDetected.next(this.isBufferDetected);
    }
    seekTime(value, byPercent = false) {
        let second;
        const duration = this.duration;
        if (byPercent) {
            second = (value * duration) / 100;
        }
        else {
            second = value;
        }
        this.currentTime = second;
    }
    addTextTrack(type, label, language, mode) {
        const newTrack = this.vgMedia.addTextTrack(type, label, language);
        if (mode) {
            newTrack.mode = mode;
        }
        return newTrack;
    }
    ngOnDestroy() {
        this.vgMedia.src = '';
        this.mutationObs?.unsubscribe();
        this.canPlayObs?.unsubscribe();
        this.canPlayThroughObs?.unsubscribe();
        this.loadedMetadataObs?.unsubscribe();
        this.waitingObs?.unsubscribe();
        this.progressObs?.unsubscribe();
        this.endedObs?.unsubscribe();
        this.playingObs?.unsubscribe();
        this.playObs?.unsubscribe();
        this.pauseObs?.unsubscribe();
        this.timeUpdateObs?.unsubscribe();
        this.volumeChangeObs?.unsubscribe();
        this.errorObs?.unsubscribe();
        this.checkBufferSubscription?.unsubscribe();
        this.syncSubscription?.unsubscribe();
        this.bufferDetected?.complete();
        this.bufferDetected?.unsubscribe();
        this.api.unregisterMedia(this);
    }
}
/** @nocollapse */ VgMediaDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: VgMediaDirective, deps: [{ token: i1.VgApiService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Directive });
/** @nocollapse */ VgMediaDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "14.0.6", type: VgMediaDirective, selector: "[vgMedia]", inputs: { vgMedia: "vgMedia", vgMaster: "vgMaster" }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: VgMediaDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[vgMedia]',
                }]
        }], ctorParameters: function () { return [{ type: i1.VgApiService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { vgMedia: [{
                type: Input
            }], vgMaster: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmctbWVkaWEuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3gtdmlkZW9ndWxhci9jb3JlL3NyYy9saWIvZGlyZWN0aXZlcy92Zy1tZWRpYS92Zy1tZWRpYS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFHVCxLQUFLLEVBQ0wsaUJBQWlCLEdBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFDTCxVQUFVLEVBRVYsT0FBTyxFQUNQLFNBQVMsRUFDVCxLQUFLLEVBQ0wsYUFBYSxHQUNkLE1BQU0sTUFBTSxDQUFDO0FBQ2QsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBTXJDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDbkUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHlDQUF5QyxDQUFDOzs7QUFLbkUsTUFBTSxPQUFPLGdCQUFnQjtJQWtEM0IsWUFBb0IsR0FBaUIsRUFBVSxHQUFzQjtRQUFqRCxRQUFHLEdBQUgsR0FBRyxDQUFjO1FBQVUsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUE1Q3JFLFVBQUssR0FBVyxRQUFRLENBQUMsU0FBUyxDQUFDO1FBRW5DLFNBQUksR0FBUSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDOUMsV0FBTSxHQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDO1FBSXpCLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFDaEIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFDdkIscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFDbEIs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Z0IsRUFBRSxXQUFXLEVBQUUsQ0FBQztRQUVyQyxJQUFJLENBQUMsY0FBYyxFQUFFLFFBQVEsRUFBRSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxjQUFjLEVBQUUsV0FBVyxFQUFFLENBQUM7UUFFbkMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakMsQ0FBQzs7Z0lBemhCVSxnQkFBZ0I7b0hBQWhCLGdCQUFnQjsyRkFBaEIsZ0JBQWdCO2tCQUg1QixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxXQUFXO2lCQUN0QjttSUFJVSxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIERpcmVjdGl2ZSxcbiAgT25Jbml0LFxuICBPbkRlc3Ryb3ksXG4gIElucHV0LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBPYnNlcnZhYmxlLFxuICBTdWJzY3JpcHRpb24sXG4gIFN1YmplY3QsXG4gIGZyb21FdmVudCxcbiAgdGltZXIsXG4gIGNvbWJpbmVMYXRlc3QsXG59IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtcbiAgSVBsYXlhYmxlLFxuICBJTWVkaWFTdWJzY3JpcHRpb25zLFxufSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL3ZnLW1lZGlhLWFwaS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSU1lZGlhRWxlbWVudCB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvaS1tZWRpYS1lbGVtZW50LmludGVyZmFjZSc7XG5pbXBvcnQgeyBWZ0FwaVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy92Zy1hcGkvdmctYXBpLnNlcnZpY2UnO1xuaW1wb3J0IHsgVmdTdGF0ZXMgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zdGF0ZXMvdmctc3RhdGVzLnNlcnZpY2UnO1xuaW1wb3J0IHsgVmdFdmVudHMgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9ldmVudHMvdmctZXZlbnRzLnNlcnZpY2UnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbdmdNZWRpYV0nLFxufSlcbmV4cG9ydCBjbGFzcyBWZ01lZGlhRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIElQbGF5YWJsZSB7XG4gIGVsZW06IGFueTtcblxuICBASW5wdXQoKSB2Z01lZGlhOiBJTWVkaWFFbGVtZW50O1xuICBASW5wdXQoKSB2Z01hc3RlcjogYm9vbGVhbjtcblxuICBzdGF0ZTogc3RyaW5nID0gVmdTdGF0ZXMuVkdfUEFVU0VEO1xuXG4gIHRpbWU6IGFueSA9IHsgY3VycmVudDogMCwgdG90YWw6IDAsIGxlZnQ6IDAgfTtcbiAgYnVmZmVyOiBhbnkgPSB7IGVuZDogMCB9O1xuICB0cmFjazogYW55O1xuICBzdWJzY3JpcHRpb25zOiBJTWVkaWFTdWJzY3JpcHRpb25zIHwgYW55O1xuXG4gIGNhblBsYXkgPSBmYWxzZTtcbiAgY2FuUGxheVRocm91Z2ggPSBmYWxzZTtcbiAgaXNNZXRhZGF0YUxvYWRlZCA9IGZhbHNlO1xuICBpc1dhaXRpbmcgPSBmYWxzZTtcbiAgaXNDb21wbGV0ZWQgPSBmYWxzZTtcbiAgaXNMaXZlID0gZmFsc2U7XG5cbiAgaXNCdWZmZXJEZXRlY3RlZCA9IGZhbHNlO1xuXG4gIGNoZWNrSW50ZXJ2YWwgPSAyMDA7XG4gIGN1cnJlbnRQbGF5UG9zID0gMDtcbiAgbGFzdFBsYXlQb3MgPSAwO1xuICBzcGVjaWZpZWREdXJhdGlvbjogbnVtYmVyO1xuXG4gIGNoZWNrQnVmZmVyU3Vic2NyaXB0aW9uOiBhbnk7XG4gIHN5bmNTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgY2FuUGxheUFsbFN1YnNjcmlwdGlvbjogYW55O1xuICBwbGF5QXRmZXJTeW5jID0gZmFsc2U7XG5cbiAgbXV0YXRpb25PYnM6IFN1YnNjcmlwdGlvbjtcbiAgY2FuUGxheU9iczogU3Vic2NyaXB0aW9uO1xuICBjYW5QbGF5VGhyb3VnaE9iczogU3Vic2NyaXB0aW9uO1xuICBsb2FkZWRNZXRhZGF0YU9iczogU3Vic2NyaXB0aW9uO1xuICB3YWl0aW5nT2JzOiBTdWJzY3JpcHRpb247XG4gIHByb2dyZXNzT2JzOiBTdWJzY3JpcHRpb247XG4gIGVuZGVkT2JzOiBTdWJzY3JpcHRpb247XG4gIHBsYXlpbmdPYnM6IFN1YnNjcmlwdGlvbjtcbiAgcGxheU9iczogU3Vic2NyaXB0aW9uO1xuICBwYXVzZU9iczogU3Vic2NyaXB0aW9uO1xuICB0aW1lVXBkYXRlT2JzOiBTdWJzY3JpcHRpb247XG4gIHZvbHVtZUNoYW5nZU9iczogU3Vic2NyaXB0aW9uO1xuICBlcnJvck9iczogU3Vic2NyaXB0aW9uO1xuXG4gIGJ1ZmZlckRldGVjdGVkOiBTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IFN1YmplY3QoKTtcblxuICBwbGF5UHJvbWlzZTogUHJvbWlzZTxhbnk+O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBpOiBWZ0FwaVNlcnZpY2UsIHByaXZhdGUgcmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAodGhpcy52Z01lZGlhLm5vZGVOYW1lKSB7XG4gICAgICAvLyBJdCdzIGEgbmF0aXZlIGVsZW1lbnRcbiAgICAgIHRoaXMuZWxlbSA9IHRoaXMudmdNZWRpYTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSXQncyBhbiBBbmd1bGFyIENsYXNzXG4gICAgICB0aGlzLmVsZW0gPSB0aGlzLnZnTWVkaWEuZWxlbTtcbiAgICB9XG5cbiAgICAvLyBKdXN0IGluIGNhc2Ugd2UncmUgY3JlYXRpbmcgdGhpcyB2Z01lZGlhIGR5bmFtaWNhbGx5IHJlZ2lzdGVyIGFnYWluIGludG8gQVBJXG4gICAgdGhpcy5hcGkucmVnaXN0ZXJNZWRpYSh0aGlzKTtcblxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IHtcbiAgICAgIC8vIE5hdGl2ZSBldmVudHNcbiAgICAgIGFib3J0OiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfQUJPUlQpLFxuICAgICAgY2FuUGxheTogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX0NBTl9QTEFZKSxcbiAgICAgIGNhblBsYXlUaHJvdWdoOiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfQ0FOX1BMQVlfVEhST1VHSCksXG4gICAgICBkdXJhdGlvbkNoYW5nZTogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX0RVUkFUSU9OX0NIQU5HRSksXG4gICAgICBlbXB0aWVkOiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfRU1QVElFRCksXG4gICAgICBlbmNyeXB0ZWQ6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19FTkNSWVBURUQpLFxuICAgICAgZW5kZWQ6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19FTkRFRCksXG4gICAgICBlcnJvcjogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX0VSUk9SKSxcbiAgICAgIGxvYWRlZERhdGE6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19MT0FERURfREFUQSksXG4gICAgICBsb2FkZWRNZXRhZGF0YTogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX0xPQURFRF9NRVRBREFUQSksXG4gICAgICBsb2FkU3RhcnQ6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19MT0FEX1NUQVJUKSxcbiAgICAgIHBhdXNlOiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfUEFVU0UpLFxuICAgICAgcGxheTogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX1BMQVkpLFxuICAgICAgcGxheWluZzogZnJvbUV2ZW50KHRoaXMuZWxlbSBhcyBhbnksIFZnRXZlbnRzLlZHX1BMQVlJTkcpLFxuICAgICAgcHJvZ3Jlc3M6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19QUk9HUkVTUyksXG4gICAgICByYXRlQ2hhbmdlOiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfUkFURV9DSEFOR0UpLFxuICAgICAgc2Vla2VkOiBmcm9tRXZlbnQodGhpcy5lbGVtIGFzIGFueSwgVmdFdmVudHMuVkdfU0VFS0VEKSxcbiAgICAgIHNlZWtpbmc6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19TRUVLSU5HKSxcbiAgICAgIHN0YWxsZWQ6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19TVEFMTEVEKSxcbiAgICAgIHN1c3BlbmQ6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19TVVNQRU5EKSxcbiAgICAgIHRpbWVVcGRhdGU6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19USU1FX1VQREFURSksXG4gICAgICB2b2x1bWVDaGFuZ2U6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19WT0xVTUVfQ0hBTkdFKSxcbiAgICAgIHdhaXRpbmc6IGZyb21FdmVudCh0aGlzLmVsZW0gYXMgYW55LCBWZ0V2ZW50cy5WR19XQUlUSU5HKSxcblxuICAgICAgLy8gQWR2ZXJ0aXNlbWVudCBvbmx5IGV2ZW50c1xuICAgICAgc3RhcnRBZHM6IGZyb21FdmVudCh3aW5kb3cgYXMgYW55LCBWZ0V2ZW50cy5WR19TVEFSVF9BRFMpLFxuICAgICAgZW5kQWRzOiBmcm9tRXZlbnQod2luZG93IGFzIGFueSwgVmdFdmVudHMuVkdfRU5EX0FEUyksXG5cbiAgICAgIC8vIFNlZSBjaGFuZ2VzIG9uIDxzb3VyY2U+IGNoaWxkIGVsZW1lbnRzIHRvIHJlbG9hZCB0aGUgdmlkZW8gZmlsZVxuICAgICAgbXV0YXRpb246IG5ldyBPYnNlcnZhYmxlKChvYnNlcnZlcjogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IGRvbU9icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KG11dGF0aW9ucyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRvbU9icy5vYnNlcnZlKHRoaXMuZWxlbSBhcyBhbnksIHsgY2hpbGRMaXN0OiB0cnVlLCBhdHRyaWJ1dGVzOiB0cnVlIH0pO1xuXG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgZG9tT2JzLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgfTtcbiAgICAgIH0pLFxuXG4gICAgICAvLyBDdXN0b20gYnVmZmVyaW5nIGRldGVjdGlvblxuICAgICAgYnVmZmVyRGV0ZWN0ZWQ6IHRoaXMuYnVmZmVyRGV0ZWN0ZWQsXG4gICAgfTtcblxuICAgIHRoaXMubXV0YXRpb25PYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMubXV0YXRpb24uc3Vic2NyaWJlKFxuICAgICAgdGhpcy5vbk11dGF0aW9uLmJpbmQodGhpcylcbiAgICApO1xuICAgIHRoaXMuY2FuUGxheU9icyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5jYW5QbGF5LnN1YnNjcmliZShcbiAgICAgIHRoaXMub25DYW5QbGF5LmJpbmQodGhpcylcbiAgICApO1xuICAgIHRoaXMuY2FuUGxheVRocm91Z2hPYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMuY2FuUGxheVRocm91Z2guc3Vic2NyaWJlKFxuICAgICAgdGhpcy5vbkNhblBsYXlUaHJvdWdoLmJpbmQodGhpcylcbiAgICApO1xuICAgIHRoaXMubG9hZGVkTWV0YWRhdGFPYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMubG9hZGVkTWV0YWRhdGEuc3Vic2NyaWJlKFxuICAgICAgdGhpcy5vbkxvYWRNZXRhZGF0YS5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICB0aGlzLndhaXRpbmdPYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMud2FpdGluZy5zdWJzY3JpYmUoXG4gICAgICB0aGlzLm9uV2FpdC5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzT2JzID0gdGhpcy5zdWJzY3JpcHRpb25zLnByb2dyZXNzLnN1YnNjcmliZShcbiAgICAgIHRoaXMub25Qcm9ncmVzcy5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICB0aGlzLmVuZGVkT2JzID0gdGhpcy5zdWJzY3JpcHRpb25zLmVuZGVkLnN1YnNjcmliZShcbiAgICAgIHRoaXMub25Db21wbGV0ZS5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICB0aGlzLnBsYXlpbmdPYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMucGxheWluZy5zdWJzY3JpYmUoXG4gICAgICB0aGlzLm9uU3RhcnRQbGF5aW5nLmJpbmQodGhpcylcbiAgICApO1xuICAgIHRoaXMucGxheU9icyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5wbGF5LnN1YnNjcmliZSh0aGlzLm9uUGxheS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnBhdXNlT2JzID0gdGhpcy5zdWJzY3JpcHRpb25zLnBhdXNlLnN1YnNjcmliZSh0aGlzLm9uUGF1c2UuYmluZCh0aGlzKSk7XG4gICAgdGhpcy50aW1lVXBkYXRlT2JzID0gdGhpcy5zdWJzY3JpcHRpb25zLnRpbWVVcGRhdGUuc3Vic2NyaWJlKFxuICAgICAgdGhpcy5vblRpbWVVcGRhdGUuYmluZCh0aGlzKVxuICAgICk7XG4gICAgdGhpcy52b2x1bWVDaGFuZ2VPYnMgPSB0aGlzLnN1YnNjcmlwdGlvbnMudm9sdW1lQ2hhbmdlLnN1YnNjcmliZShcbiAgICAgIHRoaXMub25Wb2x1bWVDaGFuZ2UuYmluZCh0aGlzKVxuICAgICk7XG4gICAgdGhpcy5lcnJvck9icyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5lcnJvci5zdWJzY3JpYmUodGhpcy5vbkVycm9yLmJpbmQodGhpcykpO1xuXG4gICAgaWYgKHRoaXMudmdNYXN0ZXIpIHtcbiAgICAgIHRoaXMuYXBpLnBsYXllclJlYWR5RXZlbnQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5wcmVwYXJlU3luYygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJlcGFyZVN5bmMoKSB7XG4gICAgY29uc3QgY2FuUGxheUFsbDogT2JzZXJ2YWJsZTxhbnk+W10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgbWVkaWEgaW4gdGhpcy5hcGkubWVkaWFzKSB7XG4gICAgICBpZiAodGhpcy5hcGkubWVkaWFzW21lZGlhXSkge1xuICAgICAgICBjYW5QbGF5QWxsLnB1c2godGhpcy5hcGkubWVkaWFzW21lZGlhXS5zdWJzY3JpcHRpb25zLmNhblBsYXkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuY2FuUGxheUFsbFN1YnNjcmlwdGlvbiA9IGNvbWJpbmVMYXRlc3QoY2FuUGxheUFsbClcbiAgICAgIC5waXBlKG1hcCgoLi4ucGFyYW1zKSA9PiB7XG4gICAgICAgIGNvbnN0IGNoZWNrUmVhZHlTdGF0ZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgIGlmICghZXZlbnQ/LnRhcmdldCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBldmVudC50YXJnZXQucmVhZHlTdGF0ZSA9PT0gNDtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBhbGxSZWFkeTogYm9vbGVhbiA9IHBhcmFtcy5zb21lKGNoZWNrUmVhZHlTdGF0ZSk7XG5cbiAgICAgICAgaWYgKGFsbFJlYWR5ICYmICF0aGlzLnN5bmNTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICB0aGlzLnN0YXJ0U3luYygpO1xuICAgICAgICAgIHRoaXMuc3luY1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICB9KSlcbiAgICAgIC5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIHN0YXJ0U3luYygpIHtcbiAgICB0aGlzLnN5bmNTdWJzY3JpcHRpb24gPSB0aW1lcigwLCAxMDAwKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBtZWRpYSBpbiB0aGlzLmFwaS5tZWRpYXMpIHtcbiAgICAgICAgaWYgKHRoaXMuYXBpLm1lZGlhc1ttZWRpYV0gIT09IHRoaXMpIHtcbiAgICAgICAgICBjb25zdCBkaWZmOiBudW1iZXIgPVxuICAgICAgICAgICAgdGhpcy5hcGkubWVkaWFzW21lZGlhXS5jdXJyZW50VGltZSAtIHRoaXMuY3VycmVudFRpbWU7XG5cbiAgICAgICAgICBpZiAoZGlmZiA8IC0wLjMgfHwgZGlmZiA+IDAuMykge1xuICAgICAgICAgICAgdGhpcy5wbGF5QXRmZXJTeW5jID0gdGhpcy5zdGF0ZSA9PT0gVmdTdGF0ZXMuVkdfUExBWUlORztcblxuICAgICAgICAgICAgdGhpcy5wYXVzZSgpO1xuICAgICAgICAgICAgdGhpcy5hcGkubWVkaWFzW21lZGlhXS5wYXVzZSgpO1xuICAgICAgICAgICAgdGhpcy5hcGkubWVkaWFzW21lZGlhXS5jdXJyZW50VGltZSA9IHRoaXMuY3VycmVudFRpbWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBsYXlBdGZlclN5bmMpIHtcbiAgICAgICAgICAgICAgdGhpcy5wbGF5KCk7XG4gICAgICAgICAgICAgIHRoaXMuYXBpLm1lZGlhc1ttZWRpYV0ucGxheSgpO1xuICAgICAgICAgICAgICB0aGlzLnBsYXlBdGZlclN5bmMgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG9uTXV0YXRpb24obXV0YXRpb25zOiBBcnJheTxNdXRhdGlvblJlY29yZD4pIHtcbiAgICAvLyBEZXRlY3QgY2hhbmdlcyBvbmx5IGZvciBzb3VyY2UgZWxlbWVudHMgb3Igc3JjIGF0dHJpYnV0ZVxuICAgIGZvciAobGV0IGkgPSAwLCBsID0gbXV0YXRpb25zLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgY29uc3QgbXV0OiBNdXRhdGlvblJlY29yZCA9IG11dGF0aW9uc1tpXTtcblxuICAgICAgaWYgKG11dC50eXBlID09PSAnYXR0cmlidXRlcycgJiYgbXV0LmF0dHJpYnV0ZU5hbWUgPT09ICdzcmMnKSB7XG4gICAgICAgIC8vIE9ubHkgbG9hZCBzcmMgZmlsZSBpZiBpdCdzIG5vdCBhIGJsb2IgKGZvciBEQVNIIC8gSExTIHNvdXJjZXMpXG4gICAgICAgIGlmIChcbiAgICAgICAgICAobXV0LnRhcmdldCBhcyBhbnkpLnNyYyAmJlxuICAgICAgICAgIChtdXQudGFyZ2V0IGFzIGFueSkuc3JjLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAobXV0LnRhcmdldCBhcyBhbnkpLnNyYy5pbmRleE9mKCdibG9iOicpIDwgMFxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLmxvYWRNZWRpYSgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICBtdXQudHlwZSA9PT0gJ2NoaWxkTGlzdCcgJiZcbiAgICAgICAgbXV0LnJlbW92ZWROb2Rlcy5sZW5ndGggJiZcbiAgICAgICAgbXV0LnJlbW92ZWROb2Rlc1swXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc291cmNlJ1xuICAgICAgKSB7XG4gICAgICAgIHRoaXMubG9hZE1lZGlhKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxvYWRNZWRpYSgpIHtcbiAgICB0aGlzLnZnTWVkaWEucGF1c2UoKTtcbiAgICB0aGlzLnZnTWVkaWEuY3VycmVudFRpbWUgPSAwO1xuXG4gICAgLy8gU3RhcnQgYnVmZmVyaW5nIHVudGlsIHdlIGNhbiBwbGF5IHRoZSBtZWRpYSBmaWxlXG4gICAgdGhpcy5zdG9wQnVmZmVyQ2hlY2soKTtcbiAgICB0aGlzLmlzQnVmZmVyRGV0ZWN0ZWQgPSB0cnVlO1xuICAgIHRoaXMuYnVmZmVyRGV0ZWN0ZWQubmV4dCh0aGlzLmlzQnVmZmVyRGV0ZWN0ZWQpO1xuXG4gICAgLy8gVE9ETzogVGhpcyBpcyB1Z2x5LCB3ZSBzaG91bGQgZmluZCBzb21ldGhpbmcgY2xlYW5lci4gRm9yIHNvbWUgcmVhc29uIGEgVGltZXJPYnNlcnZhYmxlIGRvZXNuJ3Qgd29ya3MuXG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnZnTWVkaWEubG9hZCgpLCAxMCk7XG4gIH1cblxuICBwbGF5KCkge1xuICAgIC8vIHNob3J0LWNpcmN1aXQgaWYgYWxyZWFkeSBwbGF5aW5nXG4gICAgaWYgKFxuICAgICAgdGhpcy5wbGF5UHJvbWlzZSB8fFxuICAgICAgKHRoaXMuc3RhdGUgIT09IFZnU3RhdGVzLlZHX1BBVVNFRCAmJiB0aGlzLnN0YXRlICE9PSBWZ1N0YXRlcy5WR19FTkRFRClcbiAgICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnBsYXlQcm9taXNlID0gdGhpcy52Z01lZGlhLnBsYXkoKTtcblxuICAgIC8vIGJyb3dzZXIgaGFzIGFzeW5jIHBsYXkgcHJvbWlzZVxuICAgIGlmICh0aGlzLnBsYXlQcm9taXNlICYmIHRoaXMucGxheVByb21pc2UudGhlbiAmJiB0aGlzLnBsYXlQcm9taXNlLmNhdGNoKSB7XG4gICAgICB0aGlzLnBsYXlQcm9taXNlXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnBsYXlQcm9taXNlID0gbnVsbDtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnBsYXlQcm9taXNlID0gbnVsbDtcbiAgICAgICAgICAvLyBkZWxpYmVyYXRlbHkgZW1wdHkgZm9yIHRoZSBzYWtlIG9mIGVhdGluZyBjb25zb2xlIG5vaXNlXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnBsYXlQcm9taXNlO1xuICB9XG5cbiAgcGF1c2UoKSB7XG4gICAgLy8gYnJvd3NlciBoYXMgYXN5bmMgcGxheSBwcm9taXNlXG4gICAgaWYgKHRoaXMucGxheVByb21pc2UpIHtcbiAgICAgIHRoaXMucGxheVByb21pc2UudGhlbigoKSA9PiB7XG4gICAgICAgIHRoaXMudmdNZWRpYS5wYXVzZSgpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmdNZWRpYS5wYXVzZSgpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBpZCgpIHtcbiAgICAvLyBXZSBzaG91bGQgcmV0dXJuIHVuZGVmaW5lZCBpZiB2Z01lZGlhIHN0aWxsIGRvZXNuJ3QgZXhpc3RcbiAgICBsZXQgcmVzdWx0OiBhbnk7XG5cbiAgICBpZiAodGhpcy52Z01lZGlhKSB7XG4gICAgICByZXN1bHQgPSB0aGlzLnZnTWVkaWEuaWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGdldCBkdXJhdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy52Z01lZGlhLmR1cmF0aW9uID09PSBJbmZpbml0eVxuICAgICAgPyB0aGlzLnNwZWNpZmllZER1cmF0aW9uXG4gICAgICA6IHRoaXMudmdNZWRpYS5kdXJhdGlvbjtcbiAgfVxuXG4gIHNldCBjdXJyZW50VGltZShzZWNvbmRzKSB7XG4gICAgdGhpcy52Z01lZGlhLmN1cnJlbnRUaW1lID0gc2Vjb25kcztcbiAgICAvLyB0aGlzLmVsZW0uZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoVmdFdmVudHMuVkdfU0VFSykpO1xuICB9XG5cbiAgZ2V0IGN1cnJlbnRUaW1lKCkge1xuICAgIHJldHVybiB0aGlzLnZnTWVkaWEuY3VycmVudFRpbWU7XG4gIH1cblxuICBzZXQgdm9sdW1lKHZvbHVtZSkge1xuICAgIHRoaXMudmdNZWRpYS52b2x1bWUgPSB2b2x1bWU7XG4gIH1cblxuICBnZXQgdm9sdW1lKCkge1xuICAgIHJldHVybiB0aGlzLnZnTWVkaWEudm9sdW1lO1xuICB9XG5cbiAgc2V0IHBsYXliYWNrUmF0ZShyYXRlKSB7XG4gICAgdGhpcy52Z01lZGlhLnBsYXliYWNrUmF0ZSA9IHJhdGU7XG4gIH1cblxuICBnZXQgcGxheWJhY2tSYXRlKCkge1xuICAgIHJldHVybiB0aGlzLnZnTWVkaWEucGxheWJhY2tSYXRlO1xuICB9XG5cbiAgZ2V0IGJ1ZmZlcmVkKCkge1xuICAgIHJldHVybiB0aGlzLnZnTWVkaWEuYnVmZmVyZWQ7XG4gIH1cblxuICBnZXQgdGV4dFRyYWNrcygpIHtcbiAgICByZXR1cm4gdGhpcy52Z01lZGlhLnRleHRUcmFja3M7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvbkNhblBsYXkoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuaXNCdWZmZXJEZXRlY3RlZCA9IGZhbHNlO1xuICAgIHRoaXMuYnVmZmVyRGV0ZWN0ZWQubmV4dCh0aGlzLmlzQnVmZmVyRGV0ZWN0ZWQpO1xuICAgIHRoaXMuY2FuUGxheSA9IHRydWU7XG4gICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG4gIC8vIEB0cy1pZ25vcmVcbiAgb25DYW5QbGF5VGhyb3VnaChldmVudDogYW55KSB7XG4gICAgdGhpcy5pc0J1ZmZlckRldGVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5idWZmZXJEZXRlY3RlZC5uZXh0KHRoaXMuaXNCdWZmZXJEZXRlY3RlZCk7XG4gICAgdGhpcy5jYW5QbGF5VGhyb3VnaCA9IHRydWU7XG4gICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG4gIC8vIEB0cy1pZ25vcmVcbiAgb25Mb2FkTWV0YWRhdGEoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuaXNNZXRhZGF0YUxvYWRlZCA9IHRydWU7XG5cbiAgICB0aGlzLnRpbWUgPSB7XG4gICAgICBjdXJyZW50OiAwLFxuICAgICAgbGVmdDogMCxcbiAgICAgIHRvdGFsOiB0aGlzLmR1cmF0aW9uICogMTAwMCxcbiAgICB9O1xuXG4gICAgdGhpcy5zdGF0ZSA9IFZnU3RhdGVzLlZHX1BBVVNFRDtcblxuICAgIC8vIExpdmUgc3RyZWFtaW5nIGNoZWNrXG4gICAgY29uc3QgdDogbnVtYmVyID0gTWF0aC5yb3VuZCh0aGlzLnRpbWUudG90YWwpO1xuICAgIHRoaXMuaXNMaXZlID0gdCA9PT0gSW5maW5pdHk7XG4gICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG4gIC8vIEB0cy1pZ25vcmVcbiAgb25XYWl0KGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLmlzV2FpdGluZyA9IHRydWU7XG4gICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG4gIC8vIEB0cy1pZ25vcmVcbiAgb25Db21wbGV0ZShldmVudDogYW55KSB7XG4gICAgdGhpcy5pc0NvbXBsZXRlZCA9IHRydWU7XG4gICAgdGhpcy5zdGF0ZSA9IFZnU3RhdGVzLlZHX0VOREVEO1xuICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuICAvLyBAdHMtaWdub3JlXG4gIG9uU3RhcnRQbGF5aW5nKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLnN0YXRlID0gVmdTdGF0ZXMuVkdfUExBWUlORztcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvblBsYXkoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuc3RhdGUgPSBWZ1N0YXRlcy5WR19QTEFZSU5HO1xuXG4gICAgaWYgKHRoaXMudmdNYXN0ZXIpIHtcbiAgICAgIGlmICghdGhpcy5zeW5jU3Vic2NyaXB0aW9uIHx8IHRoaXMuc3luY1N1YnNjcmlwdGlvbi5jbG9zZWQpIHtcbiAgICAgICAgdGhpcy5zdGFydFN5bmMoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnN0YXJ0QnVmZmVyQ2hlY2soKTtcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvblBhdXNlKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLnN0YXRlID0gVmdTdGF0ZXMuVkdfUEFVU0VEO1xuXG4gICAgaWYgKHRoaXMudmdNYXN0ZXIpIHtcbiAgICAgIGlmICghdGhpcy5wbGF5QXRmZXJTeW5jKSB7XG4gICAgICAgIHRoaXMuc3luY1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc3RvcEJ1ZmZlckNoZWNrKCk7XG4gICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG4gIC8vIEB0cy1pZ25vcmVcbiAgb25UaW1lVXBkYXRlKGV2ZW50OiBhbnkpIHtcbiAgICBjb25zdCBlbmQgPSB0aGlzLmJ1ZmZlcmVkLmxlbmd0aCAtIDE7XG5cbiAgICB0aGlzLnRpbWUgPSB7XG4gICAgICBjdXJyZW50OiB0aGlzLmN1cnJlbnRUaW1lICogMTAwMCxcbiAgICAgIHRvdGFsOiB0aGlzLnRpbWUudG90YWwsXG4gICAgICBsZWZ0OiAodGhpcy5kdXJhdGlvbiAtIHRoaXMuY3VycmVudFRpbWUpICogMTAwMCxcbiAgICB9O1xuXG4gICAgaWYgKGVuZCA+PSAwKSB7XG4gICAgICB0aGlzLmJ1ZmZlciA9IHsgZW5kOiB0aGlzLmJ1ZmZlcmVkLmVuZChlbmQpICogMTAwMCB9O1xuICAgIH1cbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvblByb2dyZXNzKGV2ZW50OiBhbnkpIHtcbiAgICBjb25zdCBlbmQgPSB0aGlzLmJ1ZmZlcmVkLmxlbmd0aCAtIDE7XG5cbiAgICBpZiAoZW5kID49IDApIHtcbiAgICAgIHRoaXMuYnVmZmVyID0geyBlbmQ6IHRoaXMuYnVmZmVyZWQuZW5kKGVuZCkgKiAxMDAwIH07XG4gICAgfVxuICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuICAvLyBAdHMtaWdub3JlXG4gIG9uVm9sdW1lQ2hhbmdlKGV2ZW50OiBhbnkpIHtcbiAgICAvLyBUT0RPOiBTYXZlIHRvIGxvY2Fsc3RvcmFnZSB0aGUgY3VycmVudCB2b2x1bWVcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBvbkVycm9yKGV2ZW50OiBhbnkpIHtcbiAgICAvLyBUT0RPOiBIYW5kbGUgZXJyb3IgbWVzc2FnZXNcbiAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8yMzgyODI0MS83Nzk1MjlcbiAgYnVmZmVyQ2hlY2soKSB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gMSAvIHRoaXMuY2hlY2tJbnRlcnZhbDtcbiAgICB0aGlzLmN1cnJlbnRQbGF5UG9zID0gdGhpcy5jdXJyZW50VGltZTtcblxuICAgIGlmIChcbiAgICAgICF0aGlzLmlzQnVmZmVyRGV0ZWN0ZWQgJiZcbiAgICAgIHRoaXMuY3VycmVudFBsYXlQb3MgPCB0aGlzLmxhc3RQbGF5UG9zICsgb2Zmc2V0XG4gICAgKSB7XG4gICAgICB0aGlzLmlzQnVmZmVyRGV0ZWN0ZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIHRoaXMuaXNCdWZmZXJEZXRlY3RlZCAmJlxuICAgICAgdGhpcy5jdXJyZW50UGxheVBvcyA+IHRoaXMubGFzdFBsYXlQb3MgKyBvZmZzZXRcbiAgICApIHtcbiAgICAgIHRoaXMuaXNCdWZmZXJEZXRlY3RlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIFByZXZlbnQgY2FsbHMgdG8gYnVmZmVyQ2hlY2sgYWZ0ZXIgbmdPbkRlc3Ryb3kgaGF2ZSBiZWVuIGNhbGxlZFxuICAgIGlmICghdGhpcy5idWZmZXJEZXRlY3RlZC5jbG9zZWQpIHtcbiAgICAgIHRoaXMuYnVmZmVyRGV0ZWN0ZWQubmV4dCh0aGlzLmlzQnVmZmVyRGV0ZWN0ZWQpO1xuICAgIH1cblxuICAgIHRoaXMubGFzdFBsYXlQb3MgPSB0aGlzLmN1cnJlbnRQbGF5UG9zO1xuICB9XG5cbiAgc3RhcnRCdWZmZXJDaGVjaygpIHtcbiAgICB0aGlzLmNoZWNrQnVmZmVyU3Vic2NyaXB0aW9uID0gdGltZXIoMCwgdGhpcy5jaGVja0ludGVydmFsKS5zdWJzY3JpYmUoXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMuYnVmZmVyQ2hlY2soKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgc3RvcEJ1ZmZlckNoZWNrKCkge1xuICAgIGlmICh0aGlzLmNoZWNrQnVmZmVyU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLmNoZWNrQnVmZmVyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgdGhpcy5pc0J1ZmZlckRldGVjdGVkID0gZmFsc2U7XG5cbiAgICB0aGlzLmJ1ZmZlckRldGVjdGVkLm5leHQodGhpcy5pc0J1ZmZlckRldGVjdGVkKTtcbiAgfVxuXG4gIHNlZWtUaW1lKHZhbHVlOiBudW1iZXIsIGJ5UGVyY2VudDogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgbGV0IHNlY29uZDogbnVtYmVyO1xuICAgIGNvbnN0IGR1cmF0aW9uOiBudW1iZXIgPSB0aGlzLmR1cmF0aW9uO1xuXG4gICAgaWYgKGJ5UGVyY2VudCkge1xuICAgICAgc2Vjb25kID0gKHZhbHVlICogZHVyYXRpb24pIC8gMTAwO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWNvbmQgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gc2Vjb25kO1xuICB9XG5cbiAgYWRkVGV4dFRyYWNrKFxuICAgIHR5cGU6IHN0cmluZyxcbiAgICBsYWJlbD86IHN0cmluZyxcbiAgICBsYW5ndWFnZT86IHN0cmluZyxcbiAgICBtb2RlPzogJ2Rpc2FibGVkJyB8ICdoaWRkZW4nIHwgJ3Nob3dpbmcnXG4gICk6IFRleHRUcmFjayB7XG4gICAgY29uc3QgbmV3VHJhY2s6IFRleHRUcmFjayA9IHRoaXMudmdNZWRpYS5hZGRUZXh0VHJhY2soXG4gICAgICB0eXBlLFxuICAgICAgbGFiZWwsXG4gICAgICBsYW5ndWFnZVxuICAgICk7XG5cbiAgICBpZiAobW9kZSkge1xuICAgICAgbmV3VHJhY2subW9kZSA9IG1vZGU7XG4gICAgfVxuICAgIHJldHVybiBuZXdUcmFjaztcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMudmdNZWRpYS5zcmMgPSAnJztcbiAgICB0aGlzLm11dGF0aW9uT2JzPy51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuY2FuUGxheU9icz8udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLmNhblBsYXlUaHJvdWdoT2JzPy51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMubG9hZGVkTWV0YWRhdGFPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy53YWl0aW5nT2JzPy51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMucHJvZ3Jlc3NPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5lbmRlZE9icz8udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLnBsYXlpbmdPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5wbGF5T2JzPy51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMucGF1c2VPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy50aW1lVXBkYXRlT2JzPy51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMudm9sdW1lQ2hhbmdlT2JzPy51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuZXJyb3JPYnM/LnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5jaGVja0J1ZmZlclN1YnNjcmlwdGlvbj8udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLnN5bmNTdWJzY3JpcHRpb24/LnVuc3Vic2NyaWJlKCk7XG5cbiAgICB0aGlzLmJ1ZmZlckRldGVjdGVkPy5jb21wbGV0ZSgpO1xuICAgIHRoaXMuYnVmZmVyRGV0ZWN0ZWQ/LnVuc3Vic2NyaWJlKCk7XG5cbiAgICB0aGlzLmFwaS51bnJlZ2lzdGVyTWVkaWEodGhpcyk7XG4gIH1cbn1cbiJdfQ==